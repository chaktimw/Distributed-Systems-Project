<html>
<head>
    <title>CSE486 App</title>
    <link rel="stylesheet" type="text/css" href="static/style.css"/>
</head>
<body>
<h1>Subscriber's Page</h1>

<h2>Currently advertised topic prices:</h2>
<div id ="data"></div>

<h2>Subscribe to currently advertised topics here! </h2>
<h3>Example: Inputting 5 means only games with a price below $5 will be shown! <br>
    *Note: Ignores topics not currently shown in advertised topics</h3>

<label for="input">Input price: </label>
<input id="price" type="text" name="Price">
<button onclick="subscribe()">Subscribe!</button>

<br><br>
<h2>Unsubscribe to currently advertised topics here! </h2>
<h3>Example: Inputting 5 means removing $5 games from subscription <br>
    *Note: Ignores topics not currently shown in subscribed topics</h3>

<label for="input">Input price: </label>
<input id="price2" type="text" name="Price">
<button onclick="unsubscribe()">Unsubscribe!</button>

<h2>Currently subscribed topic prices:</h2>
<div id ="data2"></div>

<br><br>
<h2>Newsfeed (Displays new games that fit under your subscriptions:</h2>
<div id ="data3"></div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf-8">
    var socket = io();
    socket.on('connect', function() {
        // connect to subscriber channel
        socket.emit('join', {"room": "subscriber"});
    });

    socket.on('load', data =>{
        let displayed_data = document.getElementById("data");
        displayed_data.innerHTML = data.data;
    });

    socket.on('advertised', data =>{
        let displayed_data = document.getElementById("data");
        displayed_data.innerHTML = data.data;
    });

    socket.on('subscribed', data =>{
        let displayed_data = document.getElementById("data2");
        displayed_data.innerHTML = data.data;
    });

    socket.on('notified', data =>{
        let displayed_data = document.getElementById("data3");
        displayed_data.innerHTML += "<b>Title: </b>" + data.data + " <b>Price: </b>" + data.price + "<br>";
    });

    function subscribe(){
        const value = parseInt(document.getElementById("price").value);
        if (Number.isInteger(value)){
            socket.emit('subscribe', {"value": value});
        }
    }
    function unsubscribe(){
        const value = parseInt(document.getElementById("price2").value);
        if (Number.isInteger(value)){
            socket.emit('unsubscribe', {"value": value});
        }
    }

</script>
</body>
</html>